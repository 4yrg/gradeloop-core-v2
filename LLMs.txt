# GradeLoop Core V2 - Web Client Context

This project is a high-performance web client built with **Bun**, **Next.js (App Router)**, and a strictly typed ecosystem for an AI-integrated Learning Management System (LMS).

---

# Primary Tech Stack

- **Runtime**: Bun (Strictly use `bun` for scripts and package management)
- **Framework**: Next.js 16+ (App Router)
- **UI Architecture**: shadcn/ui (Radix UI + TailwindCSS v4)
- **Animation**: Motion (`motion` package only â€” never `framer-motion`)
- **State Management**: Zustand v5 (Store-based, immutable state)
- **Data Layer**: TanStack Query v5
- **HTTP Client**: Axios (Instance-based)
- **Form Handling**: React Hook Form v7 with Hookform Resolvers
- **Validation**: Zod v4 (Schema-first development)
- **Styling**: TailwindCSS v4 with PostCSS
- **Utilities**: clsx (or `cn` utility), date-fns
- **Icons**: lucide-react

---

# Development Standards & Patterns

---

## 1. Data Fetching & Type Safety (The "Golden Pipeline")

All API interactions must strictly follow this pipeline:

1. **Define Zod Schema**
2. **Axios fetcher**
3. **Validate with `Schema.parse()`**
4. **Wrap in TanStack Query hook**

### Rules

- âŒ Never use `as Type` assertions
- âŒ Never return unvalidated response data
- âœ… Always validate using Zod before returning

### Required Pattern

```ts
// schemas/user.schema.ts
import { z } from "zod";

export const UserSchema = z.object({
  id: z.string(),
  name: z.string(),
  email: z.string().email(),
  role: z.enum(["student", "instructor", "admin"]),
});

export type User = z.infer<typeof UserSchema>;
```

```ts
// features/users/api/get-user.ts
import { api } from "@/lib/api";
import { UserSchema } from "@/schemas/user.schema";

export const getUser = async (id: string) => {
  const res = await api.get(`/users/${id}`);
  return UserSchema.parse(res.data);
};
```

```ts
// features/users/hooks/use-user.ts
import { useQuery } from "@tanstack/react-query";
import { getUser } from "../api/get-user";

export const useUser = (id: string) =>
  useQuery({
    queryKey: ["user", id],
    queryFn: () => getUser(id),
  });
```

---

## 2. UI & Styling (shadcn/ui + Motion + TailwindCSS v4)

### Component Source

* All UI components must be generated via **shadcn/ui CLI**
* Components live in `/components/ui`
* Built on **Radix UI primitives**
* Styled via TailwindCSS + design tokens

### Theming Rules

* Use semantic CSS variables (no raw hex in components)
* All components inherit tokens
* Dark mode via `.dark` class
* No inline styles
* No arbitrary Tailwind color values

---

### Animation Rules

Use **Motion** package only.

âœ… Correct imports:

```ts
import { motion } from "motion/react";
// or
import { motion } from "motion";
```

ğŸš« Never use:

```ts
import { motion } from "framer-motion";
```

### Animation Standards

* 60fps smooth transitions
* Prefer transform + opacity
* Avoid layout thrashing
* Use motion for:
  * Dialog transitions
  * Page transitions
  * Sidebar animations
  * Hover micro-interactions

---

## 3. Form Handling (React Hook Form + Zod)

Always use schema-first validation.

```ts
import { useForm } from "react-hook-form";
import { zodResolver } from "@hookform/resolvers/zod";
import { z } from "zod";

const formSchema = z.object({
  email: z.string().email(),
  password: z.string().min(8),
});

type FormValues = z.infer<typeof formSchema>;

const form = useForm<FormValues>({
  resolver: zodResolver(formSchema),
});
```

### UI Pattern

* Use shadcn `<Form />` wrappers
* Use `<FormField />`
* Display errors using `<FormMessage />`

---

## 4. State Management (Zustand v5)

Use typed store pattern:

```ts
import { create } from "zustand";

interface ThemeState {
  theme: "light" | "dark";
  setTheme: (theme: "light" | "dark") => void;
}

export const useThemeStore = create<ThemeState>((set) => ({
  theme: "light",
  setTheme: (theme) => set({ theme }),
}));
```

### Rules

* Use selectors to avoid re-renders
* Do NOT store TanStack Query server data
* Persist only:
  * Auth session
  * Theme preference

---

## 5. UI Component Standards (shadcn)

All components must:

* Be in `/components/ui`
* Use `cn()` utility for class merging
* Be accessible (Radix handles most)
* Support dark mode automatically
* Use semantic tokens only

### Required Base Components

* Button
* Input
* Textarea
* Select
* Card
* Table
* Badge
* Alert
* Dialog
* DropdownMenu
* Tabs
* Tooltip
* Sheet (for mobile sidebar)
* Skeleton

---

# Project Structure Reference

```
/apps/web/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ globals.css
â”‚   â”œâ”€â”€ layout.tsx
â”‚   â””â”€â”€ page.tsx
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ ui/               # shadcn components
â”‚   â””â”€â”€ layout/           # App layout components
â”œâ”€â”€ features/
â”‚   â”œâ”€â”€ auth/
â”‚   â”œâ”€â”€ dashboard/
â”‚   â”œâ”€â”€ assignments/
â”‚   â””â”€â”€ courses/
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ api.ts
â”‚   â”œâ”€â”€ query-client.ts
â”‚   â””â”€â”€ utils.ts
â”œâ”€â”€ store/
â”œâ”€â”€ schemas/
â”œâ”€â”€ public/
â”œâ”€â”€ tailwind.config.ts
â””â”€â”€ postcss.config.mjs
```

---

# Root Layout Requirements

### `layout.tsx` must:

* Wrap app in `QueryClientProvider`
* Include Theme provider (class strategy)
* Avoid hydration mismatch
* Be server-safe

### Client Providers Wrapper Pattern

```ts
// components/providers.tsx
"use client";

import { QueryClientProvider } from "@tanstack/react-query";
import { queryClient } from "@/lib/query-client";

export function Providers({ children }: { children: React.ReactNode }) {
  return (
    <QueryClientProvider client={queryClient}>
      {children}
    </QueryClientProvider>
  );
}
```

---

# Package Management (STRICT)

### Install

```bash
bun install
```

### Add dependency

```bash
bun add <package>
```

### Dev

```bash
bun run dev
```

ğŸš« Never use npm
ğŸš« Never use yarn

---

# Accessibility Standards

* WCAG 2.1 AA minimum
* 4.5:1 text contrast
* 3:1 UI component contrast
* Keyboard accessible
* Focus rings visible and styled
* No color-only state indicators

---

# Performance Requirements

* Initial page load < 2s
* 60fps animations
* Proper TanStack Query caching
* Avoid unnecessary re-renders
* Use dynamic imports where appropriate
* Avoid client components unless required

---

# Business Context

GradeLoop is an AI-integrated LMS serving:

* Students
* Instructors
* Administrators

The UI must feel:

* Professional
* Fast
* Clean
* Ergonomic for long coding sessions
* Cohesive across roles

---

# Key Features to Implement

* Role-based dashboards
* Assignment management
* AI plagiarism interface
* Real-time notifications
* Grade analytics
* Course enrollment workflows
* Authentication & authorization

---

# Critical Development Rules

* Strict TypeScript (no `any`)
* No raw API data without Zod parsing
* No direct fetch without Axios instance
* No hardcoded theme colors
* No framer-motion
* No HeroUI
* No Pages Router patterns

## Critical Instructions for AI Agents

### Package Management
- **No NPM/Yarn**: Use `bun add` and `bun run` exclusively.
- **Installation**: Always use `bun install` for dependency installation.
- **Scripts**: Run development with `bun run dev`, build with `bun run build`.

### Framework Specifics
- **shadcn/ui**: Use shadcn/ui CLI for component generation; components are based on Radix UI primitives.
- **Next.js**: Use App Router patterns, not Pages Router.
- **React**: Version 19+ with concurrent features.

### Error Handling
- Always wrap Zod parsing in try/catch within fetchers or allow TanStack Query to handle the error state for the UI.
- Use proper error boundaries for React error handling.

### Hydration & SSR
- Ensure `QueryClientProvider` is implemented in the root layout with a Client Component wrapper.
- Handle hydration mismatches properly with Next.js patterns.

### Development Workflow
1. **Dependencies**: All major dependencies are configured in package.json.
2. **Linting**: ESLint with Next.js configuration is set up.
3. **TypeScript**: Strict mode with proper path mapping (`@/*` for root imports).
4. **Git**: Follow conventional commits as specified in CONTRIBUTING.md.
