# GradeLoop Core V2 - Web Client Context

This project is a high-performance web client built with **Bun**, **Next.js (App Router)**, and a strictly typed ecosystem for an AI-integrated Learning Management System (LMS).

---

# Primary Tech Stack

- **Runtime**: Bun (Strictly use `bun` for scripts and package management)
- **Framework**: Next.js 16+ (App Router)
- **UI Architecture**: shadcn/ui (Radix UI + TailwindCSS v4)
- **Animation**: Motion (`motion` package only — never `framer-motion`)
- **State Management**: Zustand v5 (Store-based, immutable state)
- **Data Layer**: TanStack Query v5
- **HTTP Client**: Axios (Instance-based)
- **Form Handling**: React Hook Form v7 with Hookform Resolvers
- **Validation**: Zod v4 (Schema-first development)
- **Styling**: TailwindCSS v4 with PostCSS
- **Utilities**: clsx (or `cn` utility), date-fns
- **Icons**: lucide-react

---

# Development Standards & Patterns

(keep the same expectations as before for the web client; see sections below for specific rules)

---

# Go Backend — auth-service (new / updated guidance)

This repo contains a Go-based authentication service at `apps/services/auth-service`. The LLM/context file needs to include the folder structure and notes so AI agents and contributors understand the service layout, conventions, and environment variables.

Auth-service folder structure (top-level)
```
apps/services/auth-service/
├── cmd/               # entrypoints (e.g., cmd/main.go)
├── config/            # env loader, configuration helpers
├── database/          # DB connection and migrations
├── handler/           # HTTP handlers
├── middleware/        # middleware (auth, logging, etc.)
├── model/             # domain models and GORM models
├── router/            # routes setup (fiber or similar)
├── tmp/                # ephemeral files (ignored)
├── Dockerfile
├── README.md
├── go.mod
└── go.sum
```

Directory responsibilities and notes
- `cmd/`:
  - Holds `main` packages for running the service.
  - Typical command to run locally: `go run ./cmd/main.go` (or use `air` for hot reload if configured).
- `config/`:
  - Centralized env loader using `github.com/joho/godotenv` (the service ships logic that searches parent directories for `.env`).
  - Use `config.Config("KEY")` style helper across the service.
- `database/`:
  - DB connection logic (uses GORM + postgres driver).
  - Connection logic supports both:
    - Aiven-style connection via `POSTGRES_URL_BASE` + `AUTH_SVC_DB_NAME` (+ `POSTGRES_SSLMODE`)
    - Traditional env vars `DB_HOST`, `DB_PORT`, `DB_USER`, `DB_PASSWORD`, `DB_NAME`
  - For Aiven: set `POSTGRES_URL_BASE=postgres://user:pass@host:port/` and `AUTH_SVC_DB_NAME=<db>` and optionally `POSTGRES_SSLMODE=require`.
  - If `POSTGRES_URL_BASE` is present, the service will prefer that and append `AUTH_SVC_DB_NAME` as the path; otherwise it uses a formatted `host=... port=... user=...` DSN.
- `handler/`:
  - Route handlers (login/register, token endpoints).
  - Uses `config.Config("SECRET")` or similar for JWT signing.
- `middleware/`:
  - Authentication middleware (JWT validation), error handling helpers.
- `model/`:
  - GORM model definitions for `User`, `Role`, etc.
- `router/`:
  - Wiring of routes to handlers and middleware (e.g., Fiber app setup).
- `Dockerfile`:
  - Container recipe for building the service for local/dev or CI.
- `README.md`:
  - Service-specific docs and quickstart.

Environment variables (auth-service)
- Auth-specific:
  - `SECRET` — JWT secret (required)
  - `AUTH_SVC_DB_NAME` — DB name for the auth service when using Aiven-style URL (recommended if using Aiven)
- Aiven / remote DB:
  - `POSTGRES_URL_BASE` — base Postgres URL from Aiven (example: `postgres://avnadmin:xxx@<host>:<port>/`)
  - `POSTGRES_SSLMODE` — `require` for Aiven (optional)
  - When `POSTGRES_URL_BASE` and `AUTH_SVC_DB_NAME` are present, the service builds the full connection string using those values and includes `sslmode` when provided.
- Local DB fallback:
  - `DB_HOST`, `DB_PORT`, `DB_USER`, `DB_PASSWORD`, `DB_NAME` — used when `POSTGRES_URL_BASE` is not set.
- Compose & docker:
  - The infra compose can set `POSTGRES_URL_BASE` and `AUTH_SVC_DB_NAME` in the `.env` file. If you prefer local Postgres for dev, provide DB credentials instead.

Build & run (Go service)
- Local development:
  - `go install` / `go build` / `go run ./cmd/main.go`
  - Use `air` or similar for live reload (if included in Dockerfile / dev setup).
- Docker:
  - Build: `docker build -t gradeloop-auth-service .` (from `apps/services/auth-service`)
  - Run: `docker run --env-file ../../.env -p 3000:3000 gradeloop-auth-service`
- Compose (infra):
  - The minimal infra compose kept for auth-service expects external DB or Aiven. Ensure `.env` has the required Aiven vars before `docker compose up`.
- Testing:
  - Add unit tests using Go's `testing` package.
  - Use dependency injection for DB and external dependencies to enable testability.

Go tooling & code style
- Go version consistent with `go.mod` (respect `go 1.xx` in `go.mod`).
- Formatting: `gofmt -w .` and `goimports -w .`
- Linting: `golangci-lint run ./...` (recommended)
- Vet: `go vet ./...`
- Module management: `go mod tidy` to keep `go.mod` clean.

Security & secrets
- Do NOT hardcode secrets in source.
- Use `.env` (local dev) and environment configuration for production secrets (or secret management).
- Prefer Aiven's managed Postgres with secure SSL settings (e.g., `sslmode=require`).
- Ensure `SECRET` is strong, rotate periodically.

Observability & healthchecks
- The service exposes a simple health endpoint (root `/` or `/health` depending on implementation) — used by the compose healthcheck.
- Add structured logging (log level, JSON output for production) and request tracing fields (correlation id).
- Add Prometheus metrics if possible for production readiness.

---

# Java Backend (REMOVED)
- The Java backend section has been removed from this LLMs.txt. For this repository context, prioritize Go service documentation and configs and avoid instructing agents to rely on Java-specific tooling or JDK requirements.

---

# Project Structure Reference (web + selected services)

```
/apps/web/                # frontend (Next.js + Bun)
  ├── app/
  ├── components/
  ├── features/
  ├── lib/
  └── ...

/apps/services/           # microservices
  ├── auth-service/       # Go service (see structure above)
  ├── (other services...) # Java services removed from LLMs context unless present locally
```

---

# Critical Development Rules (summary)
- Strict TypeScript in the web client (no `any`).
- No raw API data without Zod parsing on the frontend.
- No NPM/Yarn for the web client: use Bun exclusively.
- For Go services:
  - Keep configuration in env files or external secret stores.
  - Do not hardcode DB credentials or secrets.
  - Use the Aiven-compatible connection flow when provided.

---

# Agent Instructions (for LLMs / automation)
- When asked to run or build services, verify the required directories exist in the repo before running `docker build` or `go build`.
- Prefer using prebuilt images for services not present locally (do not attempt to `build` when `context` path is missing).
- Use `POSTGRES_URL_BASE` + `AUTH_SVC_DB_NAME` for auth-service when available; fall back to `DB_*` env vars only when necessary.
- Do not instruct the agent to assume Java-based services are available unless their directories and build files exist.

---

# Quick reference commands

Frontend
- Install: `bun install`
- Dev: `bun run dev`
- Build: `bun run build`

Auth-service (Go)
- Build: `go build ./...` or `go build -o ./bin/auth ./cmd/main.go`
- Run: `go run ./cmd/main.go`
- Docker build: `docker build -t gradeloop-auth-service .` (from `apps/services/auth-service`)
- Lint & format: `gofmt -w . && goimports -w . && golangci-lint run ./...`

Docker Compose (infra/compose)
- From `infra/compose/`:
  - `docker compose up --build` (ensure build contexts exist or use images)
  - If using Aiven, populate `../../.env` with `POSTGRES_URL_BASE`, `AUTH_SVC_DB_NAME`, and `POSTGRES_SSLMODE=require` (and leave local DB vars empty).

---

If you need additional detail for any other service folder structures or want the Go auth-service README expanded with exact commands and examples, let me know and I will add the expanded how-to and examples (DB migration commands, sample `.env`, sample requests, etc.).
